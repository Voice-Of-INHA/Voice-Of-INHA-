import { NextRequest, NextResponse } from 'next/server'

interface AnalysisData {
  id: number
  callId: number
  audioGcsUri: string
  transcript: string
  report: {
    advice: string[]
    reasons: Array<{
      type: string
      quote: string
    }>
    summary: string
    safe_alt: string
    timeline: Array<{
      t: string
      event: string
      quote: string
    }>
    red_flags: Array<{
      name: string
      quote: string
      explanation: string
    }>
    risk_level: string
    risk_score: number
    crime_types: string[]
  }
  summary: string
  crimeType: string
  status: string
  triggeredAt: string
  completedAt: string
  error: string | null
}

// ì‹¤ì œ ë°ì´í„° (ì‚¬ìš©ìê°€ ì œê³µí•œ JSON ê¸°ë°˜)
const mockAnalysisData: Record<string, AnalysisData> = {
  "6": {
    id: 6,
    callId: 20,
    audioGcsUri: "gs://voiceofinha-s3-to-gcs/calls/20/7a33ee41-17b9-4d85-a4b6-bcddaf511f4f",
    transcript: "[T=00:00.0][SCAMMER] ì•ˆë…•í•˜ì„¸ìš” ì—¬ê¸°ëŠ” ì„œìš¸ì¤‘ì•™ì§€ê²€ í˜•ì‚¬ ê³ ì…ë‹ˆë‹¤ ê¹€ì§€ì˜ ì”¨ ë§ìœ¼ì‹œì£  ë‚´ê°€ ì™”ëŠ”ë° í˜¹ì‹œ ì–´ë–¤ ê²ƒ ë•Œë¬¸ì— ê·¸ëŸ¬ì„¸ìš”? í˜„ì¬ ë³¸ì¸ ëª…ì˜ì˜ ì€í–‰ê³„ì¢Œê°€ ë²”ì£„ì´ìš© ê°œë…ìœ¼ë¡œì¨ ì¤‘ì…ë‹ˆë‹¤. ì „í™” ë‚´ìš©ì€ ëª¨ë‘ ë…¹ìŒë˜ê³  ìˆìœ¼ë©° ì§„ì£¼ì‹œ í˜•ì‚¬ì²˜ë²Œ ëŒ€ìƒì…ë‹ˆë‹¤. ì œê°€ ì–´ë–¤ ê±° ì•„ë¬´ê²ƒë„ ì•ˆ í–ˆëŠ”ë° ì™œ ê·¸ëŸ¬ì„¸ìš”? ë³¸ì¸ëª…ì˜ ê³„ì¢Œë¡œ ë¶ˆë²• í•´ì™¸ì†¡ê¸ˆì´ ìš”ê±´ì‚¬ì‹¤ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í˜„ì¬ ê¸´ê¸‰ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\n[T=00:00.0][USER] ì•ˆë…•í•˜ì„¸ìš” ì—¬ê¸°ëŠ” ì„œìš¸ì¤‘ì•™ì§€ê²€ í˜•ì‚¬ ê³ ì…ë‹ˆë‹¤ ê¹€ì§€ì˜ ì”¨ ë§ìœ¼ì‹œì£  ë‚´ê°€ ì™”ëŠ”ë° í˜¹ì‹œ ì–´ë–¤ ê²ƒ ë•Œë¬¸ì— ê·¸ëŸ¬ì„¸ìš”? í˜„ì¬ ë³¸ì¸ ëª…ì˜ì˜ ì€í–‰ê³„ì¢Œê°€ ë²”ì£„ì´ìš© ê°œë…ìœ¼ë¡œì¨ ì¤‘ì…ë‹ˆë‹¤. ì „í™” ë‚´ìš©ì€ ëª¨ë‘ ë…¹ìŒë˜ê³  ìˆìœ¼ë©° ì§„ì£¼ì‹œ í˜•ì‚¬ì²˜ë²Œ ëŒ€ìƒì…ë‹ˆë‹¤. ì œê°€ ì–´ë–¤ ê±° ì•„ë¬´ê²ƒë„ ì•ˆ í–ˆëŠ”ë° ì™œ ê·¸ëŸ¬ì„¸ìš”? ë³¸ì¸ëª…ì˜ ê³„ì¢Œë¡œ ë¶ˆë²• í•´ì™¸ì†¡ê¸ˆì´ ìš”ê±´ì‚¬ì‹¤ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í˜„ì¬ ê¸´ê¸‰ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
    report: {
      advice: [
        "ì¦‰ì‹œ ì „í™”ë¥¼ ëŠìœ¼ì„¸ìš”.",
        "ë°œì‹  ë²ˆí˜¸ë¥¼ ì°¨ë‹¨í•˜ê³  ì ˆëŒ€ ë‹¤ì‹œ í†µí™”í•˜ì§€ ë§ˆì„¸ìš”.",
        "ì£¼ë³€ ì‚¬ëŒì—ê²Œ ìƒí™©ì„ ì•Œë¦¬ê±°ë‚˜ ê²½ì°°(112) ë˜ëŠ” ê¸ˆìœµê°ë…ì›(1332)ì— ì‹ ê³ í•˜ì—¬ ì‚¬ì‹¤ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.",
        "ì ˆëŒ€ ìƒëŒ€ë°©ì˜ ìš”êµ¬ì— ë”°ë¼ ê°œì¸ì •ë³´, ê¸ˆìœµì •ë³´ë¥¼ ì•Œë ¤ì£¼ê±°ë‚˜ ìê¸ˆì„ ì´ì²´í•˜ì§€ ë§ˆì„¸ìš”.",
        "ìƒëŒ€ë°©ì´ ë³´ë‚´ëŠ” ë¬¸ì ë©”ì‹œì§€ì˜ ë§í¬ë¥¼ í´ë¦­í•˜ê±°ë‚˜ ì•±ì„ ì„¤ì¹˜í•˜ì§€ ë§ˆì„¸ìš”."
      ],
      reasons: [
        {
          type: "ê²€ì°°ì‚¬ì¹­",
          quote: "ì•ˆë…•í•˜ì„¸ìš” ì—¬ê¸°ëŠ” ì„œìš¸ì¤‘ì•™ì§€ê²€ í˜•ì‚¬ ê³ ì…ë‹ˆë‹¤"
        },
        {
          type: "í˜‘ë°•/ë‚©ì¹˜",
          quote: "ì „í™” ë‚´ìš©ì€ ëª¨ë‘ ë…¹ìŒë˜ê³  ìˆìœ¼ë©° ì§„ì£¼ì‹œ í˜•ì‚¬ì²˜ë²Œ ëŒ€ìƒì…ë‹ˆë‹¤."
        }
      ],
      summary: "ê²€ì°°ì„ ì‚¬ì¹­í•˜ì—¬ ê³„ì¢Œê°€ ë²”ì£„ì— ì—°ë£¨ë˜ì—ˆë‹¤ê³  í˜‘ë°•í•˜ë©° ê¸´ê¸‰ ì¡°ì¹˜ë¥¼ ìš”êµ¬í•˜ëŠ” ì „í˜•ì ì¸ ë³´ì´ìŠ¤í”¼ì‹±ì…ë‹ˆë‹¤.",
      safe_alt: "ì‹¤ì œ ìˆ˜ì‚¬ê¸°ê´€ì€ ì „í™”ë¡œ ì‚¬ê±´ ìˆ˜ì‚¬ë¥¼ ì§„í–‰í•˜ì§€ ì•Šìœ¼ë©°, ê°œì¸ì˜ ê¸ˆìœµ ì •ë³´ë¥¼ ìš”êµ¬í•˜ê±°ë‚˜ ìê¸ˆ ì´ì²´ë¥¼ ì§€ì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìˆ˜ì‚¬ê°€ í•„ìš”í•œ ê²½ìš°, ê³µì‹ì ì¸ ì ˆì°¨ì— ë”°ë¼ ë“±ê¸°ìš°í¸ìœ¼ë¡œ ì¶œì„ìš”êµ¬ì„œë¥¼ ë°œì†¡í•˜ê±°ë‚˜ ê²½ì°°ê´€ì´ ì§ì ‘ ë°©ë¬¸í•©ë‹ˆë‹¤. ì „í™”ë¡œ 'ë²”ì£„ ì—°ë£¨', 'ì•ˆì „ ê³„ì¢Œ', 'ìì‚° ë³´í˜¸' ë“±ì„ ì–¸ê¸‰í•˜ëŠ” ê²½ìš°ëŠ” 100% ë³´ì´ìŠ¤í”¼ì‹±ì…ë‹ˆë‹¤.",
      timeline: [
        {
          t: "00:00",
          event: "ìˆ˜ì‚¬ê¸°ê´€ ì‚¬ì¹­ ë° ì‹ ì› í™•ì¸",
          quote: "ì•ˆë…•í•˜ì„¸ìš” ì—¬ê¸°ëŠ” ì„œìš¸ì¤‘ì•™ì§€ê²€ í˜•ì‚¬ ê³ ì…ë‹ˆë‹¤ ê¹€ì§€ì˜ ì”¨ ë§ìœ¼ì‹œì£ "
        },
        {
          t: "00:05",
          event: "ë²”ì£„ ì—°ë£¨ í†µë³´",
          quote: "í˜„ì¬ ë³¸ì¸ ëª…ì˜ì˜ ì€í–‰ê³„ì¢Œê°€ ë²”ì£„ì´ìš© ê°œë…ìœ¼ë¡œì¨ ì¤‘ì…ë‹ˆë‹¤."
        },
        {
          t: "00:08",
          event: "ë…¹ìŒ ê³ ì§€ ë° ì‹¬ë¦¬ì  ì••ë°•",
          quote: "ì „í™” ë‚´ìš©ì€ ëª¨ë‘ ë…¹ìŒë˜ê³  ìˆìœ¼ë©°"
        },
        {
          t: "00:10",
          event: "í˜•ì‚¬ì²˜ë²Œ ìœ„í˜‘",
          quote: "ì§„ì£¼ì‹œ í˜•ì‚¬ì²˜ë²Œ ëŒ€ìƒì…ë‹ˆë‹¤."
        },
        {
          t: "00:13",
          event: "êµ¬ì²´ì ì¸ ë²”ì£„ ì‚¬ì‹¤ ì–¸ê¸‰",
          quote: "ë³¸ì¸ëª…ì˜ ê³„ì¢Œë¡œ ë¶ˆë²• í•´ì™¸ì†¡ê¸ˆì´ ìš”ê±´ì‚¬ì‹¤ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—"
        },
        {
          t: "00:16",
          event: "ê¸´ê¸‰ ì¡°ì¹˜ ìš”êµ¬",
          quote: "í˜„ì¬ ê¸´ê¸‰ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤."
        }
      ],
      red_flags: [
        {
          name: "ìˆ˜ì‚¬ê¸°ê´€ ì‚¬ì¹­",
          quote: "ì—¬ê¸°ëŠ” ì„œìš¸ì¤‘ì•™ì§€ê²€ í˜•ì‚¬ ê³ ì…ë‹ˆë‹¤",
          explanation: "ìˆ˜ì‚¬ê¸°ê´€ì€ ì „í™”ë¡œ ì‚¬ê±´ì„ í†µë³´í•˜ê³  ìˆ˜ì‚¬ë¥¼ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” ì‹ ë¢°ë¥¼ ì–»ê¸° ìœ„í•œ ì „í˜•ì ì¸ ì‚¬ì¹­ ìˆ˜ë²•ì…ë‹ˆë‹¤."
        },
        {
          name: "ë‹¤ì§œê³ ì§œ ë²”ì£„ ì—°ë£¨ í†µë³´",
          quote: "í˜„ì¬ ë³¸ì¸ ëª…ì˜ì˜ ì€í–‰ê³„ì¢Œê°€ ë²”ì£„ì´ìš© ê°œë…ìœ¼ë¡œì¨ ì¤‘ì…ë‹ˆë‹¤.",
          explanation: "ì•„ë¬´ëŸ° ì‚¬ì „ ê³ ì§€ ì—†ì´ ì „í™”ë¡œ ë³¸ì¸ ê³„ì¢Œê°€ ë²”ì£„ì— ì—°ë£¨ë˜ì—ˆë‹¤ê³  ì•Œë ¤ í”¼í•´ìë¥¼ ë‹¹í™©í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤."
        },
        {
          name: "í˜•ì‚¬ì²˜ë²Œ ìœ„í˜‘",
          quote: "ì§„ì£¼ì‹œ í˜•ì‚¬ì²˜ë²Œ ëŒ€ìƒì…ë‹ˆë‹¤.",
          explanation: "ì •ìƒì ì¸ ë²• ì ˆì°¨ë¥¼ ë¬´ì‹œí•˜ê³  ì¦‰ê°ì ì¸ í˜•ì‚¬ì²˜ë²Œì„ ì–¸ê¸‰í•˜ë©° í”¼í•´ìë¥¼ ì‹¬ë¦¬ì ìœ¼ë¡œ ì••ë°•í•˜ê³  ê³µí¬ì‹¬ì„ ìœ ë°œí•©ë‹ˆë‹¤."
        },
        {
          name: "ê¸´ê¸‰ì„± ê°•ì¡°",
          quote: "í˜„ì¬ ê¸´ê¸‰ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
          explanation: "í”¼í•´ìê°€ ìƒí™©ì„å†·é™í•˜ê²Œ íŒë‹¨í•  ì‹œê°„ì„ ì£¼ì§€ ì•Šê³ , ì¦‰ê°ì ì¸ ì¡°ì¹˜ê°€ í•„ìš”í•˜ë‹¤ê³  ì¬ì´‰í•˜ì—¬ ë¹„í•©ë¦¬ì ì¸ ê²°ì •ì„ ìœ ë„í•©ë‹ˆë‹¤."
        },
        {
          name: "ë…¹ìŒ ê³ ì§€ë¥¼ í†µí•œ ì‹ ë¢° ìœ ë„",
          quote: "ì „í™” ë‚´ìš©ì€ ëª¨ë‘ ë…¹ìŒë˜ê³  ìˆìœ¼ë©°",
          explanation: "í†µí™” ë‚´ìš©ì´ ë…¹ìŒëœë‹¤ê³  ë§í•˜ë©° ë§ˆì¹˜ ê³µì‹ì ì¸ ì ˆì°¨ì¸ ê²ƒì²˜ëŸ¼ ìœ„ì¥í•˜ì—¬ ì‹ ë¢°ë¥¼ ì–»ìœ¼ë ¤ëŠ” ìˆ˜ë²•ì…ë‹ˆë‹¤."
        }
      ],
      risk_level: "HIGH",
      risk_score: 95,
      crime_types: ["ê²€ì°°ì‚¬ì¹­", "í˜‘ë°•/ë‚©ì¹˜"]
    },
    summary: "ê²€ì°°ì„ ì‚¬ì¹­í•˜ì—¬ ê³„ì¢Œê°€ ë²”ì£„ì— ì—°ë£¨ë˜ì—ˆë‹¤ê³  í˜‘ë°•í•˜ë©° ê¸´ê¸‰ ì¡°ì¹˜ë¥¼ ìš”êµ¬í•˜ëŠ” ì „í˜•ì ì¸ ë³´ì´ìŠ¤í”¼ì‹±ì…ë‹ˆë‹¤.",
    crimeType: "ê²€ì°°ì‚¬ì¹­",
    status: "DONE",
    triggeredAt: "2025-08-21T01:12:16",
    completedAt: "2025-08-21T01:13:11",
    error: null
  }
}

// ê°œë³„ í†µí™” ë¶„ì„ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” GET ì—”ë“œí¬ì¸íŠ¸
export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const { id } = params
    console.log(`ğŸ“‹ ê°œë³„ í†µí™” ë¶„ì„ ë°ì´í„° ì¡°íšŒ ìš”ì²­: ID ${id}`)
    
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•´ë‹¹ IDì˜ ë°ì´í„°ë¥¼ ì¡°íšŒ
    // const analysisData = await getAnalysisDataById(id)
    
    // ì„ì‹œë¡œ ëª©ì—… ë°ì´í„°ì—ì„œ ì¡°íšŒ (id ë˜ëŠ” callIdë¡œ ê²€ìƒ‰)
    let analysisData: AnalysisData | undefined = mockAnalysisData[id]
    
    // idë¡œ ì°¾ì§€ ëª»í•œ ê²½ìš° callIdë¡œ ê²€ìƒ‰
    if (!analysisData) {
      analysisData = Object.values(mockAnalysisData).find(data => data.callId.toString() === id)
    }
    
    if (!analysisData) {
      console.log(`âŒ ID ${id}ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)
      return NextResponse.json(
        { 
          ok: false, 
          status: "NOT_FOUND", 
          message: "í•´ë‹¹ IDì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
          data: null
        },
        { status: 404 }
      )
    }
    
    console.log(`âœ… ID ${id} í†µí™” ë¶„ì„ ë°ì´í„° ì¡°íšŒ ì„±ê³µ`)
    
    return NextResponse.json({
      ok: true,
      status: "SUCCESS",
      data: analysisData
    })
    
  } catch (error) {
    console.error('âŒ API ì—ëŸ¬:', error)
    
    return NextResponse.json(
      { 
        ok: false, 
        status: "ERROR", 
        message: "ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
        data: null
      },
      { status: 500 }
    )
  }
}